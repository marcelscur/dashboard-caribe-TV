<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Caribe Beachwear - TV</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            font-size: 16px;
        }

        @media (min-width: 1920px) {
            body { font-size: 20px; }
        }

        @media (min-width: 2560px) {
            body { font-size: 24px; }
        }

        @media (min-width: 3840px) {
            body { font-size: 32px; }
        }

        .tv-container {
            display: grid;
            grid-template-columns: 1fr;
            grid-template-rows: auto auto 1fr;
            gap: 10px;
            padding: 10px;
            height: 100vh;
            width: 100vw;
        }

        /* Header */
        header {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        h1 {
            font-size: 2.2em;
            background: linear-gradient(45deg, #00d4ff, #00ff88);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .status-info {
            display: flex;
            gap: 15px;
            align-items: center;
            font-size: 0.95em;
        }

        .status-badge {
            padding: 6px 14px;
            border-radius: 15px;
            font-size: 0.95em;
            font-weight: 600;
        }

        .badge-success { background: rgba(0, 255, 136, 0.2); color: #00ff88; }
        .badge-info { background: rgba(0, 212, 255, 0.2); color: #00d4ff; }

        /* Grid de 6 tarjetas */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 10px;
        }

        .card {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 10px;
            padding: 12px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            flex-direction: column;
        }

        .card-title {
            font-size: 0.8em;
            color: #aaa;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .card-value {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
            background: linear-gradient(45deg, #00d4ff, #00ff88);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .card-subtitle {
            font-size: 0.75em;
            color: #888;
            margin-bottom: 8px;
        }

        .business-breakdown {
            display: flex;
            flex-direction: column;
            gap: 4px;
            margin-top: 8px;
            font-size: 0.7em;
        }

        .business-item {
            display: flex;
            justify-content: space-between;
            padding: 3px 6px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
            border-left: 2px solid;
        }

        .business-item.todo { border-left-color: #ff6b6b; }
        .business-item.caribe { border-left-color: #4ecdc4; }
        .business-item.pijama { border-left-color: #ffd93d; }

        .business-name {
            color: #ccc;
        }

        .business-value {
            color: #fff;
            font-weight: 600;
        }

        .progress-bar {
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            overflow: hidden;
            margin-top: 8px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00d4ff, #00ff88);
            transition: width 0.5s ease;
            border-radius: 2px;
        }

        /* Blocos inferiores */
        .bottom-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: 1fr 1fr;
            gap: 10px;
            overflow: hidden;
        }

        .block {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 10px;
            padding: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .block-title {
            font-size: 1.15em;
            margin-bottom: 12px;
            color: #00d4ff;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
        }

        /* Tabelas */
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9em;
        }

        th {
            background: rgba(0, 212, 255, 0.15);
            padding: 8px 10px;
            text-align: left;
            font-weight: 600;
            color: #00d4ff;
            font-size: 0.95em;
            border-bottom: 1px solid rgba(0, 212, 255, 0.3);
        }

        td {
            padding: 8px 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .medal {
            font-size: 1.3em;
            margin-right: 5px;
        }

        /* Gr√°ficos */
        .chart-wrapper {
            flex: 1;
            position: relative;
            min-height: 0;
        }

        .chart-wrapper canvas {
            max-height: 100% !important;
        }

        /* Config panel */
        .config-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(30, 30, 46, 0.98);
            border: 2px solid rgba(0, 212, 255, 0.5);
            border-radius: 15px;
            padding: 30px;
            z-index: 1000;
            min-width: 500px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .config-panel input {
            width: 100%;
            padding: 12px;
            margin: 15px 0;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: #fff;
            font-size: 1em;
        }

        .config-panel button {
            width: 100%;
            padding: 14px;
            margin-top: 10px;
            background: linear-gradient(45deg, #00d4ff, #00ff88);
            border: none;
            border-radius: 8px;
            color: #000;
            font-weight: 600;
            font-size: 1em;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .config-panel button:hover {
            transform: scale(1.02);
        }

        .hidden {
            display: none !important;
        }

        .refresh-info {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9em;
            color: #888;
        }

        .countdown {
            background: rgba(0, 212, 255, 0.2);
            padding: 4px 10px;
            border-radius: 12px;
            color: #00d4ff;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <!-- Panel de Configuraci√≥n -->
    <div id="config-panel" class="config-panel">
        <h2 style="color: #00d4ff; margin-bottom: 20px;">‚öôÔ∏è Configuraci√≥n del Dashboard</h2>
        <div>
            <label style="color: #aaa;">URL de la API:</label>
            <input type="text" id="api-url-input" placeholder="https://probiz.chat/api/dashboard">
        </div>
        <div>
            <label style="color: #aaa;">Intervalo de actualizaci√≥n (segundos):</label>
            <input type="number" id="refresh-interval-input" value="60" min="10" max="600">
        </div>
        <button onclick="saveConfig()">üíæ Guardar y Activar</button>
        <p style="margin-top: 15px; color: #888; font-size: 0.9em; text-align: center;">
            Presiona 'C' en cualquier momento para abrir esta configuraci√≥n
        </p>
    </div>

    <!-- Dashboard Principal -->
    <div id="tv-dashboard" class="tv-container hidden">
        <header>
            <div class="header-left">
                <h1>üèñÔ∏è Dashboard Caribe Beachwear</h1>
                <div class="status-info">
                    <span class="status-badge badge-success">‚óè En Vivo</span>
                    <span class="status-badge badge-info" id="last-update">Actualizando...</span>
                </div>
            </div>
            <div class="refresh-info">
                <span>üîÑ Pr√≥xima actualizaci√≥n en:</span>
                <span class="countdown" id="countdown">--</span>
            </div>
        </header>

        <!-- 6 Tarjetas Principales -->
        <div class="cards-grid">
            <!-- Card 1: Ventas Generales -->
            <div class="card">
                <div class="card-title">üí∞ Ventas Totales</div>
                <div class="card-value" id="ventas-totales">0</div>
                <div class="card-subtitle">Ventas del per√≠odo</div>
                <div class="business-breakdown">
                    <div class="business-item todo">
                        <span class="business-name">Todo para Revender</span>
                        <span class="business-value" id="ventas-todo">0</span>
                    </div>
                    <div class="business-item caribe">
                        <span class="business-name">Caribe Beachwear</span>
                        <span class="business-value" id="ventas-caribe">0</span>
                    </div>
                    <div class="business-item pijama">
                        <span class="business-name">Pijama de Seda</span>
                        <span class="business-value" id="ventas-pijama">0</span>
                    </div>
                </div>
            </div>

            <!-- Card 2: Meta General -->
            <div class="card">
                <div class="card-title">üéØ Meta General</div>
                <div class="card-value" id="meta-total">0</div>
                <div class="card-subtitle" id="percentual-meta">0% alcanzado</div>
                <div class="business-breakdown">
                    <div class="business-item todo">
                        <span class="business-name">Todo para Revender</span>
                        <span class="business-value" id="meta-todo">0</span>
                    </div>
                    <div class="business-item caribe">
                        <span class="business-name">Caribe Beachwear</span>
                        <span class="business-value" id="meta-caribe">0</span>
                    </div>
                    <div class="business-item pijama">
                        <span class="business-name">Pijama de Seda</span>
                        <span class="business-value" id="meta-pijama">0</span>
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-meta"></div>
                </div>
            </div>

            <!-- Card 3: Proyecci√≥n Semanal -->
            <div class="card">
                <div class="card-title">üìà Proyecci√≥n Semanal</div>
                <div class="card-value" id="proyeccion-total">0</div>
                <div class="card-subtitle" id="percentual-proyeccion">0% de la meta</div>
                <div class="business-breakdown">
                    <div class="business-item todo">
                        <span class="business-name">Todo para Revender</span>
                        <span class="business-value" id="proyeccion-todo">0</span>
                    </div>
                    <div class="business-item caribe">
                        <span class="business-name">Caribe Beachwear</span>
                        <span class="business-value" id="proyeccion-caribe">0</span>
                    </div>
                    <div class="business-item pijama">
                        <span class="business-name">Pijama de Seda</span>
                        <span class="business-value" id="proyeccion-pijama">0</span>
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-proyeccion"></div>
                </div>
            </div>

            <!-- Card 4: Atenciones Totales -->
            <div class="card">
                <div class="card-title">üë• Atenciones</div>
                <div class="card-value" id="atenciones-totales">0</div>
                <div class="card-subtitle">Clientes atendidos</div>
                <div class="business-breakdown">
                    <div class="business-item todo">
                        <span class="business-name">Todo para Revender</span>
                        <span class="business-value" id="atenciones-todo">0</span>
                    </div>
                    <div class="business-item caribe">
                        <span class="business-name">Caribe Beachwear</span>
                        <span class="business-value" id="atenciones-caribe">0</span>
                    </div>
                    <div class="business-item pijama">
                        <span class="business-name">Pijama de Seda</span>
                        <span class="business-value" id="atenciones-pijama">0</span>
                    </div>
                </div>
            </div>

            <!-- Card 5: Conversi√≥n -->
            <div class="card">
                <div class="card-title">‚ú® Conversi√≥n</div>
                <div class="card-value" id="conversion-total">0%</div>
                <div class="card-subtitle">Tasa de conversi√≥n</div>
                <div class="business-breakdown">
                    <div class="business-item todo">
                        <span class="business-name">Todo para Revender</span>
                        <span class="business-value" id="conversion-todo">0%</span>
                    </div>
                    <div class="business-item caribe">
                        <span class="business-name">Caribe Beachwear</span>
                        <span class="business-value" id="conversion-caribe">0%</span>
                    </div>
                    <div class="business-item pijama">
                        <span class="business-name">Pijama de Seda</span>
                        <span class="business-value" id="conversion-pijama">0%</span>
                    </div>
                </div>
            </div>

            <!-- Card 6: Resultado Mensual -->
            <div class="card">
                <div class="card-title">üì¶ Pedidos Mensuales</div>
                <div class="card-value" id="resultado-total">0</div>
                <div class="card-subtitle">Total de pedidos del mes</div>
                <div class="business-breakdown">
                    <div class="business-item todo">
                        <span class="business-name">Todo para Revender</span>
                        <span class="business-value" id="resultado-todo">0</span>
                    </div>
                    <div class="business-item caribe">
                        <span class="business-name">Caribe Beachwear</span>
                        <span class="business-value" id="resultado-caribe">0</span>
                    </div>
                    <div class="business-item pijama">
                        <span class="business-name">Pijama de Seda</span>
                        <span class="business-value" id="resultado-pijama">0</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bloques inferiores -->
        <div class="bottom-grid">
            <!-- Ranking de Vendedoras -->
            <div class="block">
                <div class="block-title">üèÜ Ranking de Ventas</div>
                <table id="ranking-table">
                    <thead>
                        <tr>
                            <th>Pos</th>
                            <th>Colaboradora</th>
                            <th>Ventas</th>
                            <th>Meta</th>
                            <th>%</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>

            <!-- Gr√°fico de Ventas vs Meta -->
            <div class="block">
                <div class="block-title">üìä Ventas vs Meta</div>
                <div class="chart-wrapper">
                    <canvas id="vendasChart"></canvas>
                </div>
            </div>

            <!-- Gr√°fico Radar de Power -->
            <div class="block">
                <div class="block-title">‚ö° Power de Colaboradoras</div>
                <div class="chart-wrapper">
                    <canvas id="powerChart"></canvas>
                </div>
            </div>

            <!-- Detalles de Performance -->
            <div class="block">
                <div class="block-title">üíé Performance Detallada</div>
                <table id="detalhes-table">
                    <thead>
                        <tr>
                            <th>Pos</th>
                            <th>Colaboradora</th>
                            <th>Ventas</th>
                            <th>Power</th>
                            <th>Conv</th>
                            <th>Calidad</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>

            <!-- Gr√°fico de M√©tricas -->
            <div class="block">
                <div class="block-title">üìà Atenciones y Conversi√≥n</div>
                <div class="chart-wrapper">
                    <canvas id="metricsChart"></canvas>
                </div>
            </div>

            <!-- Ranking Resort -->
            <div class="block">
                <div class="block-title">üè® Ranking de Resorts</div>
                <table id="resort-table">
                    <thead>
                        <tr>
                            <th>Pos</th>
                            <th>Resort</th>
                            <th>Puntos</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        let vendasChart = null;
        let metricsChart = null;
        let powerChart = null;
        let autoRefreshInterval = null;
        let countdownInterval = null;
        let refreshSeconds = 60;

        function saveConfig() {
            const apiUrl = document.getElementById('api-url-input').value.trim();
            const interval = parseInt(document.getElementById('refresh-interval-input').value);

            if (!apiUrl) {
                alert('Por favor, ingrese una URL v√°lida');
                return;
            }

            if (interval < 10 || interval > 600) {
                alert('El intervalo debe estar entre 10 y 600 segundos');
                return;
            }

            localStorage.setItem('dashboard_api_url', apiUrl);
            localStorage.setItem('dashboard_refresh_interval', interval);
            refreshSeconds = interval;

            document.getElementById('config-panel').classList.add('hidden');
            document.getElementById('tv-dashboard').classList.remove('hidden');

            loadData();
            startAutoRefresh();
        }

        function startAutoRefresh() {
            if (autoRefreshInterval) clearInterval(autoRefreshInterval);
            if (countdownInterval) clearInterval(countdownInterval);

            let countdown = refreshSeconds;
            
            countdownInterval = setInterval(function() {
                countdown--;
                if (countdown <= 0) countdown = refreshSeconds;
                document.getElementById('countdown').textContent = countdown + 's';
            }, 1000);

            autoRefreshInterval = setInterval(function() {
                loadData();
                countdown = refreshSeconds;
            }, refreshSeconds * 1000);
        }

        function loadData() {
            const apiUrl = localStorage.getItem('dashboard_api_url');
            
            fetch(apiUrl)
                .then(function(response) { return response.json(); })
                .then(function(data) {
                    updateDashboard(data);
                    const now = new Date();
                    document.getElementById('last-update').textContent = 
                        now.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' });
                })
                .catch(function(error) {
                    console.error('Error al cargar datos:', error);
                    document.getElementById('last-update').textContent = '‚ùå Error';
                });
        }

        function updateDashboard(data) {
            if (!data || !data.totais || !data.vendedoras) return;

            console.log('Dados recebidos:', data); // Debug

            // Mapear vendedoras por negocio - usando nomes parciais para matching
            const businessMap = {
                'Todo para Revender': ['steisy', 'nicole'],
                'Caribe Beachwear': ['yendri', 'ianny'],
                'Pijama de Seda': ['wennifer', 'maibeth']
            };

            // Calcular totais por neg√≥cio
            const businessData = {
                'Todo para Revender': { vendas: 0, meta: 0, atenciones: 0, resultado: 0 },
                'Caribe Beachwear': { vendas: 0, meta: 0, atenciones: 0, resultado: 0 },
                'Pijama de Seda': { vendas: 0, meta: 0, atenciones: 0, resultado: 0 }
            };

            // Processar cada vendedora
            data.vendedoras.forEach(function(v) {
                const nomeLower = v.nome.toLowerCase();
                console.log('Processando vendedora:', v.nome); // Debug
                
                for (let business in businessMap) {
                    const found = businessMap[business].some(function(nome) {
                        return nomeLower.includes(nome);
                    });
                    
                    if (found) {
                        console.log(v.nome + ' -> ' + business); // Debug
                        businessData[business].vendas += v.vendas || 0;
                        businessData[business].meta += v.meta || 0;
                        businessData[business].atenciones += v.atendimentos || 0;
                        businessData[business].resultado += (v.vendas || 0) * 1500;
                        break; // Sai do loop ap√≥s encontrar
                    }
                }
            });

            console.log('Business Data:', businessData); // Debug

            // Card 1: Ventas Totales
            document.getElementById('ventas-totales').textContent = data.totais.vendas;
            document.getElementById('ventas-todo').textContent = businessData['Todo para Revender'].vendas;
            document.getElementById('ventas-caribe').textContent = businessData['Caribe Beachwear'].vendas;
            document.getElementById('ventas-pijama').textContent = businessData['Pijama de Seda'].vendas;

            // Card 2: Meta General
            document.getElementById('meta-total').textContent = data.totais.meta;
            const percMeta = ((data.totais.vendas / data.totais.meta) * 100).toFixed(1);
            document.getElementById('percentual-meta').textContent = percMeta + '% alcanzado';
            document.getElementById('progress-meta').style.width = Math.min(percMeta, 100) + '%';
            document.getElementById('meta-todo').textContent = businessData['Todo para Revender'].meta;
            document.getElementById('meta-caribe').textContent = businessData['Caribe Beachwear'].meta;
            document.getElementById('meta-pijama').textContent = businessData['Pijama de Seda'].meta;

            // Card 3: Proyecci√≥n Semanal
            const proyeccionTotal = Math.round((data.totais.vendas / 3) * 7);
            document.getElementById('proyeccion-total').textContent = proyeccionTotal;
            const percProj = ((proyeccionTotal / data.totais.meta) * 100).toFixed(1);
            document.getElementById('percentual-proyeccion').textContent = percProj + '% de la meta';
            document.getElementById('progress-proyeccion').style.width = Math.min(percProj, 100) + '%';
            
            document.getElementById('proyeccion-todo').textContent = 
                Math.round((businessData['Todo para Revender'].vendas / 3) * 7);
            document.getElementById('proyeccion-caribe').textContent = 
                Math.round((businessData['Caribe Beachwear'].vendas / 3) * 7);
            document.getElementById('proyeccion-pijama').textContent = 
                Math.round((businessData['Pijama de Seda'].vendas / 3) * 7);

            // Card 4: Atenciones
            document.getElementById('atenciones-totales').textContent = data.totais.atendimentos;
            document.getElementById('atenciones-todo').textContent = businessData['Todo para Revender'].atenciones;
            document.getElementById('atenciones-caribe').textContent = businessData['Caribe Beachwear'].atenciones;
            document.getElementById('atenciones-pijama').textContent = businessData['Pijama de Seda'].atenciones;

            // Card 5: Conversi√≥n
            const convTotal = data.totais.conversion || 
                (data.totais.atendimentos > 0 ? ((data.totais.vendas / data.totais.atendimentos) * 100).toFixed(1) : 0);
            document.getElementById('conversion-total').textContent = convTotal + '%';
            
            const convTodo = businessData['Todo para Revender'].atenciones > 0 ?
                ((businessData['Todo para Revender'].vendas / businessData['Todo para Revender'].atenciones) * 100).toFixed(1) : 0;
            const convCaribe = businessData['Caribe Beachwear'].atenciones > 0 ?
                ((businessData['Caribe Beachwear'].vendas / businessData['Caribe Beachwear'].atenciones) * 100).toFixed(1) : 0;
            const convPijama = businessData['Pijama de Seda'].atenciones > 0 ?
                ((businessData['Pijama de Seda'].vendas / businessData['Pijama de Seda'].atenciones) * 100).toFixed(1) : 0;
            
            document.getElementById('conversion-todo').textContent = convTodo + '%';
            document.getElementById('conversion-caribe').textContent = convCaribe + '%';
            document.getElementById('conversion-pijama').textContent = convPijama + '%';

            // Card 6: Pedidos Mensuales (quantidade de vendas/pedidos)
            document.getElementById('resultado-total').textContent = data.totais.vendas;
            document.getElementById('resultado-todo').textContent = businessData['Todo para Revender'].vendas;
            document.getElementById('resultado-caribe').textContent = businessData['Caribe Beachwear'].vendas;
            document.getElementById('resultado-pijama').textContent = businessData['Pijama de Seda'].vendas;

            // Preparar dados para gr√°ficos
            const vendedoras = data.vendedoras.map(function(v) { return v.nome; });
            const vendas = data.vendedoras.map(function(v) { return v.vendas; });
            const metas = data.vendedoras.map(function(v) { return v.meta; });
            const atendimentos = data.vendedoras.map(function(v) { return v.atendimentos || 0; });

            console.log('Chamando fun√ß√µes de gr√°ficos...'); // Debug

            // Atualizar todos os gr√°ficos e tabelas
            createVendasChart(vendedoras, vendas, metas);
            console.log('‚úì createVendasChart executado'); // Debug
            
            createRankingTable(data.vendedoras);
            console.log('‚úì createRankingTable executado'); // Debug
            
            createDetalhesTable(data.vendedoras);
            console.log('‚úì createDetalhesTable executado'); // Debug
            
            createMetricsChart(vendedoras, atendimentos, vendas);
            console.log('‚úì createMetricsChart executado'); // Debug
            
            createPowerChart(vendedoras, data.vendedoras);
            console.log('‚úì createPowerChart executado'); // Debug
            
            // Atualizar tabela de resort se existir
            if (data.rankingResort && data.rankingResort.length > 0) {
                console.log('Dados de resort encontrados:', data.rankingResort); // Debug
                createResortTable(data.rankingResort);
                console.log('‚úì createResortTable executado'); // Debug
            } else {
                console.log('‚ö† Dados de resort n√£o encontrados ou vazios'); // Debug
            }
            
            console.log('Todos os gr√°ficos e tabelas atualizados!'); // Debug
        }

        function createVendasChart(vendedoras, vendas, metas) {
            const ctx = document.getElementById('vendasChart');
            if (!ctx) return;
            
            if (vendasChart) vendasChart.destroy();

            vendasChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: vendedoras,
                    datasets: [{
                        label: 'Ventas',
                        data: vendas,
                        backgroundColor: 'rgba(0, 212, 255, 0.6)',
                        borderColor: 'rgba(0, 212, 255, 1)',
                        borderWidth: 2
                    }, {
                        label: 'Meta',
                        data: metas,
                        backgroundColor: 'rgba(0, 255, 136, 0.3)',
                        borderColor: 'rgba(0, 255, 136, 1)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { 
                        legend: { 
                            labels: { color: '#fff', font: { size: 13 } } 
                        } 
                    },
                    scales: {
                        y: { 
                            beginAtZero: true, 
                            ticks: { color: '#fff', font: { size: 12 } }, 
                            grid: { color: 'rgba(255,255,255,0.1)' } 
                        },
                        x: { 
                            ticks: { color: '#fff', font: { size: 12 } }, 
                            grid: { color: 'rgba(255,255,255,0.1)' } 
                        }
                    }
                }
            });
        }

        function createRankingTable(vendedoras) {
            const tbody = document.querySelector('#ranking-table tbody');
            tbody.innerHTML = '';

            const sorted = vendedoras.slice().sort(function(a, b) { return b.vendas - a.vendas; });
            const medals = ['ü•á', 'ü•à', 'ü•â', '4Ô∏è‚É£', '5Ô∏è‚É£', '6Ô∏è‚É£'];

            sorted.forEach(function(v, i) {
                const perc = v.meta > 0 ? ((v.vendas / v.meta) * 100).toFixed(1) : 0;
                tbody.innerHTML += 
                    '<tr>' +
                    '<td><span class="medal">' + (medals[i] || (i + 1)) + '</span></td>' +
                    '<td><strong>' + v.nome + '</strong></td>' +
                    '<td>' + v.vendas + '</td>' +
                    '<td>' + v.meta + '</td>' +
                    '<td>' + perc + '%</td>' +
                    '</tr>';
            });
        }

        function createDetalhesTable(vendedoras) {
            const tbody = document.querySelector('#detalhes-table tbody');
            tbody.innerHTML = '';

            const sorted = vendedoras.slice().sort(function(a, b) { 
                return (b.power || 0) - (a.power || 0); 
            });
            
            const medals = ['ü•á', 'ü•à', 'ü•â', '4Ô∏è‚É£', '5Ô∏è‚É£', '6Ô∏è‚É£'];

            sorted.forEach(function(v, i) {
                tbody.innerHTML += 
                    '<tr>' +
                    '<td><span class="medal">' + (medals[i] || (i + 1)) + '</span></td>' +
                    '<td><strong>' + v.nome + '</strong></td>' +
                    '<td>' + v.vendas + '</td>' +
                    '<td>' + (v.power || 0) + '%</td>' +
                    '<td>' + (v.conversion || 0) + '%</td>' +
                    '<td>' + (v.calidad || 0) + '%</td>' +
                    '</tr>';
            });
        }

        function createMetricsChart(vendedoras, atendimentos, vendas) {
            const ctx = document.getElementById('metricsChart');
            console.log('createMetricsChart chamado - ctx:', ctx); // Debug
            if (!ctx) {
                console.error('Canvas metricsChart n√£o encontrado!');
                return;
            }
            
            if (metricsChart) metricsChart.destroy();

            const conversoes = atendimentos.map(function(at, i) {
                return at > 0 ? ((vendas[i] / at) * 100).toFixed(2) : 0;
            });

            console.log('Dados Metrics:', { vendedoras, atendimentos, conversoes }); // Debug

            metricsChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: vendedoras,
                    datasets: [{
                        label: 'Atenciones',
                        data: atendimentos,
                        borderColor: 'rgba(255, 193, 7, 1)',
                        backgroundColor: 'rgba(255, 193, 7, 0.2)',
                        yAxisID: 'y',
                        fill: true,
                        tension: 0.4
                    }, {
                        label: 'Conversi√≥n (%)',
                        data: conversoes,
                        borderColor: 'rgba(0, 255, 136, 1)',
                        backgroundColor: 'rgba(0, 255, 136, 0.2)',
                        yAxisID: 'y1',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { 
                        legend: { 
                            labels: { color: '#fff', font: { size: 13 } } 
                        } 
                    },
                    scales: {
                        y: { 
                            type: 'linear', 
                            position: 'left', 
                            ticks: { color: '#fff', font: { size: 12 } }, 
                            grid: { color: 'rgba(255,255,255,0.1)' } 
                        },
                        y1: { 
                            type: 'linear', 
                            position: 'right', 
                            ticks: { color: '#fff', font: { size: 12 } }, 
                            grid: { drawOnChartArea: false } 
                        },
                        x: { 
                            ticks: { color: '#fff', font: { size: 12 } }, 
                            grid: { color: 'rgba(255,255,255,0.1)' } 
                        }
                    }
                }
            });
        }

        function createPowerChart(vendedoras, data) {
            const ctx = document.getElementById('powerChart');
            console.log('createPowerChart chamado - ctx:', ctx); // Debug
            if (!ctx) {
                console.error('Canvas powerChart n√£o encontrado!');
                return;
            }
            
            if (powerChart) powerChart.destroy();

            const powers = data.map(function(v) { return v.power || 0; });
            console.log('Dados Power:', { vendedoras, powers }); // Debug

            powerChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: vendedoras,
                    datasets: [{
                        label: 'Power (%)',
                        data: powers,
                        borderColor: 'rgba(0, 212, 255, 1)',
                        backgroundColor: 'rgba(0, 212, 255, 0.2)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { 
                        legend: { 
                            labels: { color: '#fff', font: { size: 13 } } 
                        } 
                    },
                    scales: {
                        r: { 
                            ticks: { 
                                color: '#fff', 
                                backdropColor: 'transparent', 
                                font: { size: 11 } 
                            },
                            grid: { color: 'rgba(255,255,255,0.2)' },
                            pointLabels: { color: '#fff', font: { size: 12 } }
                        }
                    }
                }
            });
        }

        function createResortTable(ranking) {
            const tbody = document.querySelector('#resort-table tbody');
            console.log('createResortTable chamado - tbody:', tbody, 'ranking:', ranking); // Debug
            if (!tbody) {
                console.error('Tabela resort-table tbody n√£o encontrada!');
                return;
            }
            
            tbody.innerHTML = '';
            const medals = ['ü•á', 'ü•à', 'ü•â', '4Ô∏è‚É£', '5Ô∏è‚É£', '6Ô∏è‚É£', '7Ô∏è‚É£', '8Ô∏è‚É£'];

            ranking.forEach(function(item, i) {
                tbody.innerHTML += 
                    '<tr>' +
                    '<td><span class="medal">' + (medals[i] || (i + 1)) + '</span></td>' +
                    '<td><strong>' + item.nome + '</strong></td>' +
                    '<td>' + item.pontos + '</td>' +
                    '</tr>';
            });
            
            console.log('Tabela resort preenchida com', ranking.length, 'itens'); // Debug
        }

        // Auto-carregar se j√° configurado
        window.addEventListener('load', function() {
            const apiUrl = localStorage.getItem('dashboard_api_url');
            const interval = localStorage.getItem('dashboard_refresh_interval');
            
            if (interval) refreshSeconds = parseInt(interval);
            
            if (apiUrl) {
                document.getElementById('config-panel').classList.add('hidden');
                document.getElementById('tv-dashboard').classList.remove('hidden');
                loadData();
                startAutoRefresh();
            }
        });

        // Limpar ao fechar
        window.addEventListener('beforeunload', function() {
            if (autoRefreshInterval) clearInterval(autoRefreshInterval);
            if (countdownInterval) clearInterval(countdownInterval);
        });

        // Atalho para reconfigurar (pressione 'C')
        document.addEventListener('keydown', function(e) {
            if (e.key === 'c' || e.key === 'C') {
                document.getElementById('config-panel').classList.toggle('hidden');
            }
        });
    </script>
</body>
</html>
